function F(j,x=document){return x.querySelector(j)}function I(j,x=document){return[...x.querySelectorAll(j)]}var B={};async function V(j,x){dispatchEvent(new Event("before:route")),B[location.pathname]=window.scrollY;let z=P(await q(j)),E=F("title",z)?.textContent;if(E)document.title=E;let G='[name="nue:components"]',J=F(G,z);if(!J)return location.href=j;F(G).content=J.content;for(let O of I("script[src]",z))await import(O.getAttribute("src"));let N=D(z);if(w(N,()=>{let O=W(F("main"),F("main",z));W(F("body"),F("body2",z),O);let{hash:U}=location,Q=U&&F(U);scrollTo(0,Q?Q.offsetTop-parseInt(getComputedStyle(Q).scrollMarginTop)||0:0),dispatchEvent(new Event("route"));let[u,H]=location.pathname.split("/");dispatchEvent(new Event(`route:${H||"home"}`)),C(j)}),!x)history.pushState({path:j},0,j)}function K(j,x){j.addEventListener("click",(z)=>{let E=z.target.closest("[href]"),G=E?.getAttribute("href"),J=E?.getAttribute("target"),N=G?.split("/")?.pop()?.split(/[#?]/)?.shift();if(z.defaultPrevented||z.metaKey||z.ctrlKey||z.shiftKey||z.altKey||!G||G[0]=="#"||G?.includes("//")||G?.startsWith("mailto:")||N?.includes(".")&&!N?.endsWith(".html")||!!J)return;if(G!=location.pathname)x(E.pathname,E);z.preventDefault()})}function L(j){let x=location.pathname;return x.slice(0,x.lastIndexOf("/")+1)+j}function C(j,x="aria-current"){if(j[0]!="/")j=L(j);I(`[${x}]`).forEach((z)=>z.removeAttribute(x)),I("a").forEach((z)=>{if(!z.hash&&z.pathname==j)setTimeout(()=>z.setAttribute(x,"page"),50)})}function M(){if(!document.startViewTransition)document.startViewTransition=(j)=>j();history.pushState({path:location.pathname},0),K(document,async(j,x)=>{let z=F("img",x);if(z)z.style.viewTransitionName="active-image";document.startViewTransition(async()=>{await V(j)})}),C(location.pathname),addEventListener("popstate",(j)=>{let{path:x}=j.state||{};if(x){let z=B[x];document.startViewTransition(async()=>{await V(x,!0),setTimeout(()=>window.scrollTo(0,z||0),10)})}})}function R(j,x){if(j.length!=x.length)return!1;for(let z=0;z<j.length;z++)if(j[z].tagName!=x[z].tagName)return!1;return!0}function W(j,x,z){if(!j||!x)return!0;if(R(j.children,x.children))return[...j.children].forEach((E,G)=>{if(!(z&&E.tagName=="MAIN"))A(E,x.children[G])}),!0;else j.innerHTML=x.innerHTML}function A(j,x){if(j.outerHTML.replace(' aria-current="page"',"")!=x.outerHTML)j.replaceWith(x.cloneNode(!0))}function D(j){let x=I("link, style"),z=T(x,I("link, style",j));return z.forEach((E)=>F("head").appendChild(E)),v(j),z.filter((E)=>E.tagName=="link")}function X(j,x){return x.find((z)=>z.getAttribute("href")==j.getAttribute("href"))}function T(j,x){return j.forEach((z,E)=>z.disabled=!X(z,x)),x.filter((z)=>!X(z,j))}function Y(j){return I("style",j).find((x)=>!x.attributes.length)}function v(j){let x=Y(),z=Y(j);if(x)x.replaceWith(z);else if(z)F("head").appendChild(z)}var Z={};async function q(j){let x=Z[j];if(x)return x;let z=await fetch(j);if(x=await z.text(),z.status==404&&x?.trim()[0]!="<"){let E=document.title="Page not found";F("article").innerHTML=`<section><h1>${E}</h1></section>`}else Z[j]=x;return x}function P(j){j=j.replace(/<(\/?)body/g,"<$1body2");let x=document.createElement("template");return x.innerHTML=j.trim(),x.content}function w(j,x){let z=0;!j[0]?x():j.forEach((E,G)=>{S(E.href,()=>{if(++z==j.length)x()})})}function S(j,x){let z=document.createElement("link");z.rel="stylesheet",z.href=j,F("head").appendChild(z),z.onload=x}if(typeof window=="object")M();export{M as setupTransitions,C as setActive,K as onclick,V as loadPage,I as $$,F as $};
